<article class="post" itemscope="" itemtype="http://schema.org/BlogPosting"></article>
<a href="https://youtu.be/3Wv3aXXPSHI">Video Demo</a>
<div>
  <p class="c7 c13"><span class="c1"></span></p>
</div>
<h1 class="c29 c35" id="h.68j9abc9tcwd"><span class="c17"></span></h1>
<p class="c14 c13 title" id="h.909zgb9it2vv">
  <span class="c34 c36"></span>
</p>
<p class="c14 c13 title" id="h.bjwexm36wf05">
  <span class="c36 c34"></span>
</p>
<p class="c13 c14 title" id="h.xkjfh1bqbk3">
  <span class="c36 c34"></span>
</p>
<p class="c14 c13 title" id="h.98bxuuqncatk">
  <span class="c36 c34"></span>
</p>
<p class="c14 c13 title" id="h.amz33khrb59">
  <span class="c36 c34"></span>
</p>
<p class="c14 title" id="h.cczcc7gj1wly">
  <span class="c36 c34">Project: Radiance</span>
</p>
<p class="c27"><span class="c1">Corey Auger</span></p>
<p class="c7 c13"><span class="c1"></span></p>
<hr style="page-break-before: always; display: none" />
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c41">
  <span class="c2"
    ><a class="c15" href="#h.3whdolqztqhl">What is Radiance</a></span
  ><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c2"><a class="c15" href="#h.3whdolqztqhl">2</a></span>
</p>
<p class="c22">
  <span class="c2"
    ><a class="c15" href="#h.4fe4vxgm7mf3"
      >What Problems Does Radiance Solve?</a
    ></span
  ><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c2"><a class="c15" href="#h.4fe4vxgm7mf3">2</a></span>
</p>
<p class="c16">
  <span><a class="c15" href="#h.tmovnqvopm8a">How Does it Do This</a></span
  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span><a class="c15" href="#h.tmovnqvopm8a">2</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.r0uyntf03wcw">Transparent Service Design</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.r0uyntf03wcw">2</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.mw9bggkqntdo">Shared Design patterns</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.mw9bggkqntdo">2</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.2otpxr3r0rrb"
      >Automated CI/CD scale and deploy</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.2otpxr3r0rrb">3</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.husmv7i3ov7u">Monitoring and Tracing</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.husmv7i3ov7u">3</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.j85o77cwt2mj"
      >Serialization/Schema Evolution</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.j85o77cwt2mj">3</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.q0zbc77xaiml">Local Development support</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.q0zbc77xaiml">3</a></span>
</p>
<p class="c19">
  <span class="c1"
    ><a class="c15" href="#h.fx8wjftoun1g"
      >Community source repository and (store)</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.fx8wjftoun1g">4</a></span>
</p>
<p class="c22">
  <span class="c2"
    ><a class="c15" href="#h.37680n7nwnxc">Who is this for?</a></span
  ><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c2"><a class="c15" href="#h.37680n7nwnxc">4</a></span>
</p>
<p class="c22">
  <span class="c2"
    ><a class="c15" href="#h.9uwurnvoxk2r">How Does it Work?</a></span
  ><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c2"><a class="c15" href="#h.9uwurnvoxk2r">4</a></span>
</p>
<p class="c16">
  <span class="c1"><a class="c15" href="#h.xpvgs8ym2em6">Project Setup</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.xpvgs8ym2em6">4</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.46e0nbiiyclc">Create a Service</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.46e0nbiiyclc">9</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.5wrzbaei4p8w"
      >Visualizing Service Communication</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.5wrzbaei4p8w">14</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.7gi3o4d1760w"
      >Event Triggers and Smoke Testing</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.7gi3o4d1760w">15</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.2van473qhewp"
      >Automated Test Driven Design</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.2van473qhewp">17</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.6r6pc6rd3fo2">Manage Kafka through the UI</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.6r6pc6rd3fo2">17</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.sfofmwfkai1">Manage Cassandra through UI</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.sfofmwfkai1">17</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.wohtk8cww51a"
      >Manage your Entity and Readside through UI</a
    ></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.wohtk8cww51a">18</a></span>
</p>
<p class="c22">
  <span class="c2"
    ><a class="c15" href="#h.edywbbk00a76">Anatomy of a Service</a></span
  ><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c2"><a class="c15" href="#h.edywbbk00a76">18</a></span>
</p>
<p class="c16">
  <span class="c1"><a class="c15" href="#h.lwd4ryp8sfw7">Typebus</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.lwd4ryp8sfw7">18</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.7n4di9gscepv">Project Structure</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.7n4di9gscepv">18</a></span>
</p>
<p class="c16">
  <span class="c1"><a class="c15" href="#h.b80ke5oe56nv">Data</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.b80ke5oe56nv">19</a></span>
</p>
<p class="c16">
  <span class="c1"><a class="c15" href="#h.cf2g984qe63e">Service</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.cf2g984qe63e">20</a></span>
</p>
<p class="c16">
  <span class="c1"
    ><a class="c15" href="#h.bk5g3zu288w5">Service Loader</a></span
  ><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span class="c1"><a class="c15" href="#h.bk5g3zu288w5">21</a></span>
</p>
<p class="c28">
  <span><a class="c15" href="#h.u33zu9amzvpp">Entity</a></span
  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
  ><span><a class="c15" href="#h.u33zu9amzvpp">22</a></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h1 class="c29 c35" id="h.k95b13v8wc4o"><span class="c17"></span></h1>
<hr style="page-break-before: always; display: none" />
<h1 class="c29 c35" id="h.vfkeu12pu61"><span class="c17"></span></h1>
<h1 class="c29" id="h.3whdolqztqhl">
  <span class="c17">What is Radiance</span>
</h1>
<p class="c7">
  <span class="c1"
    >Radiance is a cloud-based microservice framework. It offers out of the box
    &ldquo;good choices&rdquo; for: message patterns, serialization, code
    structure, testing, and monitoring. This allows for teams to be more
    productive and agile, enabling them to focus on the business problems that
    matter.</span
  >
</p>

<p class="c7 c13"><span class="c1"></span></p>
<h1 class="c29" id="h.4fe4vxgm7mf3">
  <span class="c17">What Problems Does Radiance Solve?</span>
</h1>
<p class="c7">
  <span class="c1"
    >Working as an ELE and having created my own microservices for years prior,
    I have noticed a number of emerging patterns. These patterns require that we
    solve the same problem many times over and requiring a lot of effort.
    &nbsp;</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >The goal of Radiance is to create a transparent and fun environment for
    lightning fast creativity and design experimentation, while providing the
    facilities necessary for reactive production environment.
    &nbsp;Philosophically these software patterns embed professionals into the
    project in such a way that contributions are more meaningful and fun to
    execute on. &nbsp;</span
  >
</p>
<h2 class="c26" id="h.tmovnqvopm8a">
  <span class="c6">How Does it Do This?</span>
</h2>
<p class="c7">
  <span class="c1"
    >All communication is strongly typed and happens over Kafka.
    &nbsp;Everything is transparent and predictable. &nbsp;Kafka is the nervous
    system for creating a complex biology of microservices.</span
  >
</p>
<h3 class="c8" id="h.r0uyntf03wcw">
  <span class="c11">Transparent Service Design</span>
</h3>
<p class="c7">
  <span class="c1"
    >Services are self documenting and deploy an API that is visible and
    test/triggerable from anyone using the framework.</span
  >
</p>
<ul class="c20 lst-kix_wtu94lotl989-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Services contain a &ldquo;side-channel&rdquo;. &nbsp;Radiance uses this
      for operational and probing mechanisms into the service.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1">User code also has ways to hook into side channel. </span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c39">ServiceDescriptors</span
    ><span class="c1"
      >&nbsp;are one of the elements broadcast over this channel.</span
    >
  </li>
</ul>
<ul class="c20 lst-kix_wtu94lotl989-1 start">
  <li class="c7 c10 li-bullet-0">
    <span class="c1">This contains API type specifications</span>
  </li>
  <li class="c7 c10 li-bullet-0">
    <span class="c1">Schema information for types</span>
  </li>
  <li class="c7 c10 li-bullet-0">
    <span class="c1">Other service level information.</span>
  </li>
</ul>
<ul class="c20 lst-kix_wtu94lotl989-0">
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Radiance then has everything it needs to synthesize triggering and
      monitoring of API commands/events.</span
    >
  </li>
</ul>
<p class="c7 c13"><span class="c2"></span></p>
<h3 class="c8" id="h.mw9bggkqntdo">
  <span class="c11">Shared Design patterns</span>
</h3>
<p class="c7">
  <span class="c1"
    >Similar to Lagom, we provide a shared set of design patterns that are easy
    to understand and use. &nbsp;Radiance provides message serialization and
    schema information out of the box and services are nothing more than methods
    with the signature X =&gt; Future[Y]. &nbsp;With this simplicity, complexity
    is only added when asking the user to understand CQRS principles for storing
    and retrieving state.</span
  >
</p>
<ul class="c20 lst-kix_6inremrw7cer-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Similar to Lagom an Entity Sharded actor is provided for managing
      aggregate roots of the domain.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span>Uses Akka Typed Persistence.</span>
  </li>
</ul>
<h3 class="c8" id="h.2otpxr3r0rrb">
  <span class="c11">Automated CI/CD scale and deploy</span>
</h3>
<p class="c7">
  <span class="c1"
    >Radiance is built on top of kubernetes with built-in support to compile and
    deploy/scale services. &nbsp;In the future, it will support webhooks and
    triggers to further integrate with existing pipelines.</span
  >
</p>
<ul class="c20 lst-kix_n1fxjlpdw8z-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1">Triggers for alerts </span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1">Triggers to auto scale.</span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Instantly create mirrored staging and dev environments from the current
      snapshot (planned dev)</span
    >
  </li>
</ul>
<h3 class="c8" id="h.husmv7i3ov7u">
  <span class="c11">Monitoring and Tracing</span>
</h3>
<p class="c7">
  <span>Monitoring and tracing are b</span
  ><span class="c1"
    >uilt in as first class citizens of the platform. &nbsp;Setting filters and
    watching visual events pass through this system makes debugging and
    troubleshooting easier to reason over. &nbsp;Exceptions are bubbled up as
    events that are pushed through the cluster. &nbsp;</span
  >
</p>
<ul class="c20 lst-kix_ftp2al9firzr-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Zoom to instances of services and get configuration and log information
    </span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Exceptions bubble up to the UI and allow for automatic unit test creation
      (auto TDD)</span
    >
  </li>
</ul>
<h3 class="c8" id="h.j85o77cwt2mj">
  <span class="c11">Serialization/Schema Evolution</span>
</h3>
<p class="c7">
  <span>This is one </span
  ><span class="c1"
    >&nbsp;of the most challenging aspects of working with a distributed system.
    Radiance manges the serialization and schema for all the types that you
    declare. &nbsp;Deployment checks &nbsp;type information that is checked
    against services that use those types. &nbsp;Breaking changes gate
    deployments to not allow failure based on schema evolution.</span
  >
</p>
<ul class="c20 lst-kix_tyfad2st5l7u-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1">Avro used for byte serialization of all types</span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Code generation to native scala types with proper inheritance (no
      HLists)</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Gate services deployment that are going to &ldquo;break&rdquo; others
      that use it. Resolution can come in:</span
    >
  </li>
</ul>
<ul class="c20 lst-kix_tyfad2st5l7u-1 start">
  <li class="c7 c10 li-bullet-0">
    <span class="c1">Resulting service reverting back to old schema</span>
  </li>
  <li class="c7 c10 li-bullet-0">
    <span class="c1"
      >Updating the dependant services and rolling them all out will unlock the
      gate when satisfied.</span
    >
  </li>
</ul>
<p class="c7 c13"><span class="c1"></span></p>
<h3 class="c8" id="h.q0zbc77xaiml">
  <span class="c11">Local Development support</span>
</h3>
<p class="c7">
  <span class="c1"
    >It is no longer feasible to develop complex distributed system on a local
    environment. &nbsp;Radiance angles to attempt to solve this problem with
    future releases.
  </span>
</p>
<p class="c7">
  <span class="c1"
    >Ideally there would be a single dev environment but have developers feel
    like it is an isolated environment.</span
  >
</p>
<ul class="c20 lst-kix_kdu5wte891qq-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c1"
      >Events could be isolated with kafka instances per developer and have a
      switchboard.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c1">Tag and partition read/write models.</span>
  </li>
  <li class="c7 c18 li-bullet-0">
    <span>Right now local dev for microservices is a huge pain point. </span>
  </li>
</ul>
<h3 class="c8" id="h.fx8wjftoun1g">
  <span class="c11">Community source repository and (store)</span>
</h3>
<p class="c7">
  <span class="c1"
    >Allow for people to share solution that contain scaling profiles and test
    metrics. &nbsp;People can share free and paid solutions to well known
    service problems: Bank Accounts, User Managers, Document Stores, Machine
    Learning Model Deployment, and much more.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h1 class="c29" id="h.37680n7nwnxc">
  <span class="c17">Who is this for?</span>
</h1>
<p class="c7">
  <span class="c1"
    >Small and medium sized players who are looking for a way of affording the
    kinds of tools Lightbend offers. &nbsp;These businesses are the innovators -
    large companies innovate less quickly and adeptly, and right now
    they&rsquo;re the only ones who can afford our services. &nbsp;Offering an
    accessible solution to small, nimble innovators opens the door to a whole
    new market segment and a whole new audience of potential
    &nbsp;advocates.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h1 class="c29" id="h.9uwurnvoxk2r">
  <span class="c17">How Does it Work?</span>
</h1>
<h2 class="c26" id="h.xpvgs8ym2em6">
  <span class="c6">Project Setup</span>
</h2>
<p class="c7">
  <span class="c1"
    >Radiance is a cloud based service where a customer would sign up and choose
    from a list of supported data centers: Azure, Aws, GCloud, etc..</span
  >
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 508px;
    "
    ><img
      alt=""
      src="assets/images/image12.png"
      style="
        width: 624px;
        height: 508px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7">
  <span class="c1"
    >Once a data center is chosen, there would be choices on initial
    subscription level. &nbsp;This is really just initial Kafka and Cassandra
    sizings. &nbsp;At this point we would begin to spin up a kubernetes cluster
    with the 2 Radiance Internal services.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >It is worth noting that Radiance has been designed using Radiance.
    &nbsp;The services that reside on the &ldquo;host&rdquo; network are just
    plain old radiance services that do some additional book keeping and
    communication with the mother ship.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >When the cluster communicates that it is ready, the user is redirected to
    the initial screen where they begin the setup. &nbsp;This initial setup
    includes specifying a project, adding RSA keys to &nbsp;the git repository
    and giving us the ssh formatted url endpoint for such repository.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 532px;
    "
    ><img
      alt=""
      src="assets/images/image7.png"
      style="
        width: 624px;
        height: 532px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 456px;
    "
    ><img
      alt=""
      src="assets/images/image8.png"
      style="
        width: 624px;
        height: 456px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >After this &nbsp;is a simple setup for a docker image repository. &nbsp;A
    future version could have cloud based options or the ability to include
    harbour hosted inside your kubernetes cluster. &nbsp;For now &nbsp;a url and
    credentials form input is offered.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 337.33px;
    "
    ><img
      alt=""
      src="assets/images/image4.png"
      style="
        width: 624px;
        height: 337.33px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7">
  <span class="c1"
    >The next options would allow for persistent volume setup and initial kafka
    sizing. &nbsp;Right now there are no options and the default of disk storage
    and 3 broker kafka cluster via strimzi operator are setup. &nbsp;The final
    step is to create a project with the correct setup.</span
  >
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 338.67px;
    "
    ><img
      alt=""
      src="assets/images/image5.png"
      style="
        width: 624px;
        height: 338.67px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7">
  <span
    >After the project is set up, users are &nbsp;redirected to the radiance UI
    where there are &nbsp; two internal radiance services already running.
    &nbsp;Normally these two services would be hidden unless the option to show
    them is </span
  ><span>selected</span><span class="c1">.</span>
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 441.33px;
    "
    ><img
      alt=""
      src="assets/images/image2.png"
      style="
        width: 624px;
        height: 441.33px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.46e0nbiiyclc">
  <span class="c6">Create a Service</span>
</h2>
<p class="c7">
  <span
    >Services are also known as Modules (the naming of ServiceService
    didn&rsquo;t work for me). &nbsp;To create a new service you click the top
    left UI button &ldquo;Create Service&rdquo;. &nbsp;This will bring up a
    screen where the service definition can be filled out.</span
  ><span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 478.67px;
    "
    ><img
      alt=""
      src="assets/images/image13.png"
      style="
        width: 624px;
        height: 478.67px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >As soon as &nbsp;the service code is generated it can be &nbsp;pushed into
    your git repository. &nbsp;A build is kicked off and the service is
    instantly deployed into the cluster. &nbsp;The build and deploy can be
    observed through the interactive log.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 537.33px;
    "
    ><img
      alt=""
      src="assets/images/image9.png"
      style="
        width: 624px;
        height: 537.33px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 401.33px;
    "
    ><img
      alt=""
      src="assets/images/image14.png"
      style="
        width: 624px;
        height: 401.33px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7">
  <span class="c1"
    >In future sections of this document I will review the service code that is
    actually generated. &nbsp;When the build log completed successfully a docker
    image will &nbsp;exist in our image repository.The new services will be
    visible in our list of services and simply clicking the deploy option will
    deploy 3 instances of the service to the cluster.</span
  >
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 410.67px;
    "
    ><img
      alt=""
      src="assets/images/image11.png"
      style="
        width: 624px;
        height: 410.67px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >Clicking on any service will bring up the details page for that service.
    &nbsp;Here &nbsp;is visibility into the running instances of the service as
    well as all traced message traffic to that service. &nbsp;Additionally other
    services that will be using the API for this service can be declared.
    &nbsp;The next iteration will allow for you to probe your Entities and view
    the state of any Entity in that Service.</span
  >
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 606.67px;
    "
    ><img
      alt=""
      src="assets/images/image1.png"
      style="
        width: 624px;
        height: 606.67px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.5wrzbaei4p8w">
  <span class="c6">Visualizing Service Communication</span>
</h2>
<p class="c7">
  <span class="c1"
    >I have played with modeling the connections and interactions of Services in
    Radiance. &nbsp;The early results are very promising and create a super
    intuitive way for filter and watching messages move through the cluster.
    &nbsp; Clicking on the events in the left column will highlight the
    connection in red for the diagram such that you can trace the message
    through the components of the system. The large blue circle in the center is
    Kafka where every message passes.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 472px;
    "
    ><img
      alt=""
      src="assets/images/image15.png"
      style="
        width: 624px;
        height: 472px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.7gi3o4d1760w">
  <span class="c6">Event Triggers and Smoke Testing</span>
</h2>
<p class="c7">
  <span class="c1"
    >The UI allows customers &nbsp;to select any API elements that Services
    expose. A dialog box opens with a JSON structure to fill out that will get
    byte serialized to avro and pushed onto the kafka bus targeting that API
    endpoint. &nbsp;In this way events are triggered and can &nbsp;flow through
    the entire system. &nbsp;Any exceptions that bubble up the radiance layer
    are caught wrapped and pushed onto the bus where they are collected by the
    UI for further processing.</span
  >
</p>
<p class="c7">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 469.33px;
    "
    ><img
      alt=""
      src="assets/images/image10.png"
      style="
        width: 624px;
        height: 469.33px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    >Clicking in events in the system will expose the headers and rich payload
    for that event. &nbsp;The Avro schema for that event type may also be
    viewed. &nbsp;Future iterations would allow tagging and filtering of
    &nbsp;events to be analyzed and traced. </span
  ><span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 624px;
      height: 470.67px;
    "
    ><img
      alt=""
      src="assets/images/image6.png"
      style="
        width: 624px;
        height: 470.67px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.2van473qhewp">
  <span class="c6">Automated Test Driven Design</span>
</h2>
<p class="c7">
  <span class="c1"
    >Exception events also capture the API command that caused that exception
    for the service. &nbsp;The UI allows for an Automated Unit Test Creation,
    that will inject this API command as a test for the service allowing Test
    Driven Design (TDD).</span
  >
</p>
<h2 class="c26" id="h.6r6pc6rd3fo2">
  <span class="c6">Manage Kafka through the UI</span>
</h2>
<p class="c7">
  <span class="c1"
    >This would be a wrapper around the strimzi operator. &nbsp;Work on this has
    not been started.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.sfofmwfkai1">
  <span class="c6">Manage Cassandra through UI</span>
</h2>
<p class="c7">
  <span class="c1"
    >This would be a wrapper around the incubator cassandra Operator. Work on
    this has not been started.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.wohtk8cww51a">
  <span class="c6">Manage your Entity and Readside through UI</span>
</h2>
<p class="c7">
  <span class="c1">More to come on this one.. Stay tuned.</span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<h1 class="c29" id="h.edywbbk00a76">
  <span class="c17">Anatomy of a Service</span>
</h1>
<h2 class="c26" id="h.lwd4ryp8sfw7"><span class="c6">Typebus</span></h2>
<p class="c7">
  <span
    >The underlying architecture relies heavily on my typebus framework.
    &nbsp;This is the layer that pushes types onto Kafka via the kafka alpakka
    connector. &nbsp;I have written a series of blog post on the framework
    here:</span
  >
</p>
<ul class="c20 lst-kix_gxdp7ewo48l3-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c21"
      ><a
        class="c15"
        href="https://www.google.com/url?q=https://medium.com/@coreyauger/typebus-a-modern-guide-for-building-distributed-systems-with-scala-and-akka-28ce22fe661&amp;sa=D&amp;source=editors&amp;ust=1630011116739000&amp;usg=AOvVaw3SXb4zgthPgUAaFCtpqyzf"
        >typebus: A modern guide for building distributed systems with scala and
        akka</a
      ></span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c21"
      ><a
        class="c15"
        href="https://www.google.com/url?q=https://medium.com/@coreyauger/anatomy-of-a-typebus-service-7a7a110d5954&amp;sa=D&amp;source=editors&amp;ust=1630011116740000&amp;usg=AOvVaw1c9vf3yd7DXEuuqxv23K2x"
        >typebus: Anatomy of a typebus Service</a
      ></span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c21"
      ><a
        class="c15"
        href="https://www.google.com/url?q=https://medium.com/@coreyauger/service-composition-8e4fca245e28&amp;sa=D&amp;source=editors&amp;ust=1630011116740000&amp;usg=AOvVaw2YaEfEraVyNabjWQiEPW04"
        >tyepbus: Service Composition</a
      ></span
    >
  </li>
</ul>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span class="c1"
    >Note: there has been a lot of great improvements made to the library since
    writing the posts.</span
  >
</p>
<h2 class="c26" id="h.7n4di9gscepv">
  <span class="c6">Project Structure</span>
</h2>
<p class="c7">
  <span class="c1">The project is divided into 4 major file components:</span>
</p>
<ul class="c20 lst-kix_542esh3sjk5j-0 start">
  <li class="c7 c18 li-bullet-0">
    <span class="c38">data</span
    ><span class="c1"
      >&nbsp;- this is where we define our API and Entity data transfer
      objects.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c38">TestEntity</span
    ><span class="c1"
      >&nbsp;- This is our &ldquo;write side&rdquo; entity and is currently
      modeled after the Lagom Entities.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c38">TestserviceService</span
    ><span class="c1"
      >&nbsp;- Here is where the service code lives. &nbsp;Services are a
      collection of methods that take types from our data and apply a X =&gt;
      Future[U] transformation function.</span
    >
  </li>
  <li class="c7 c18 li-bullet-0">
    <span class="c38">TestserviceServiceLoader</span
    ><span class="c1"
      >&nbsp;- Entry point and DI framework for the bootstrapping.
    </span>
  </li>
</ul>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c30" id="h.52bw9l2x6f46">
  <span
    style="
      overflow: hidden;
      display: inline-block;
      margin: 0px 0px;
      border: 0px solid #000000;
      transform: rotate(0rad) translateZ(0px);
      -webkit-transform: rotate(0rad) translateZ(0px);
      width: 498px;
      height: 567px;
    "
    ><img
      alt=""
      src="assets/images/image3.png"
      style="
        width: 498px;
        height: 567px;
        margin-left: 0px;
        margin-top: 0px;
        transform: rotate(0rad) translateZ(0px);
        -webkit-transform: rotate(0rad) translateZ(0px);
      "
      title=""
  /></span>
</h2>
<h2 class="c26" id="h.b80ke5oe56nv"><span class="c6">Data</span></h2>
<p class="c7">
  <span class="c1"
    >In this package object are &nbsp;definitions of &nbsp;all the types that
    our Service will use. &nbsp;This includes entity types and API
    commands/events. &nbsp;Any types that will travel over kafka and thus be
    exposed to readiance platform are registered with the macro:</span
  >
</p>
<p class="c7">
  <span class="c4">Typebus</span><span class="c3">.declareType[</span
  ><span class="c4">X</span><span class="c3">, </span
  ><span class="c4">AvroByteStreamReader</span><span class="c3">[</span
  ><span class="c4">X</span><span class="c3">], </span
  ><span class="c4">AvroByteStreamWriter</span><span class="c3">[</span
  ><span class="c4">X</span><span class="c3 c34">]]</span>
</p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7">
  <span
    >Additionally we define our data access trait so that we can mock it for
    testing. &nbsp;This file is very easy to read and I have included the fully
    generated one from our Test service we created above.
  </span>
</p>
<p class="c7 c13"><span class="c3 c34"></span></p>
<a id="t.927a7fd14391341fb95792d1ddb277287c74f4d9"></a><a id="t.0"></a>
<table class="c32">
  <tbody>
    <tr class="c24">
      <td class="c25" colspan="1" rowspan="1">
        <p class="c9">
          <span class="c0">package</span
          ><span class="c3">&nbsp;com.affine.</span
          ><span class="c4">TestService</span
          ><span class="c3"><br /><br /></span><span class="c0">import</span
          ><span class="c3">&nbsp;java.util.</span><span class="c4">UUID</span
          ><span class="c3"><br /><br /></span><span class="c0">import</span
          ><span class="c3"
            >&nbsp;com.lightbend.lagom.scaladsl.persistence.</span
          ><span class="c4">PersistentEntity</span><span class="c3">.</span
          ><span class="c4">ReplyType</span><span class="c3"><br /></span
          ><span class="c0">import</span
          ><span class="c3">&nbsp;io.surfkit.typebus._<br /></span
          ><span class="c0">import</span
          ><span class="c3">&nbsp;scala.concurrent.</span
          ><span class="c4">Future</span><span class="c3"><br /><br /></span
          ><span class="c0">package</span><span class="c3">&nbsp;</span
          ><span class="c0">object</span><span class="c3">&nbsp;</span
          ><span class="c4">data</span
          ><span class="c3">&nbsp;{<br /><br /> </span
          ><span class="c0">trait</span><span class="c3">&nbsp;</span
          ><span class="c4">TestCommand</span><span class="c3">[</span
          ><span class="c4">R</span><span class="c3">] </span
          ><span class="c0">extends</span><span class="c3">&nbsp;</span
          ><span class="c4">ReplyType</span><span class="c3">[</span
          ><span class="c4">R</span><span class="c3">]<br /><br /> </span
          ><span class="c0">case</span><span class="c3">&nbsp;</span
          ><span class="c0">class</span><span class="c3">&nbsp;</span
          ><span class="c4">CreateTestCommand</span
          ><span class="c3">(entity: </span><span class="c4">Test</span
          ><span class="c3">) </span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">TestCommand</span
          ><span class="c3">[</span><span class="c4">Test</span
          ><span class="c3">]<br /> </span><span class="c0">case</span
          ><span class="c3">&nbsp;</span><span class="c0">class</span
          ><span class="c3">&nbsp;</span><span class="c4">GetTestCommand</span
          ><span class="c3">(id: </span><span class="c4">UUID</span
          ><span class="c3">) </span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">TestCommand</span
          ><span class="c3">[</span><span class="c4">Test</span
          ><span class="c3">]<br /><br /> </span><span class="c0">sealed</span
          ><span class="c3">&nbsp;</span><span class="c0">trait</span
          ><span class="c3">&nbsp;</span><span class="c4">TestEvent</span
          ><span class="c3"><br /><br /> </span><span class="c0">case</span
          ><span class="c3">&nbsp;</span><span class="c0">class</span
          ><span class="c3">&nbsp;</span><span class="c4">TestCreated</span
          ><span class="c3">(entity: </span><span class="c4">Test</span
          ><span class="c3">) </span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">TestEvent</span
          ><span class="c3"><br /> </span><span class="c0">case</span
          ><span class="c3">&nbsp;</span><span class="c0">class</span
          ><span class="c3">&nbsp;</span><span class="c4">TestState</span
          ><span class="c3">(entity: </span><span class="c4">Option</span
          ><span class="c3">[</span><span class="c4">Test</span
          ><span class="c3">], timeStamp: </span><span class="c4">String</span
          ><span class="c3">)<br /> </span><span class="c0">case</span
          ><span class="c3">&nbsp;</span><span class="c0">class</span
          ><span class="c3">&nbsp;</span><span class="c4">Test</span
          ><span class="c3">(id: </span><span class="c4">UUID</span
          ><span class="c3">, data: </span><span class="c4">String</span
          ><span class="c3">)<br /><br /> </span><span class="c0">object</span
          ><span class="c3">&nbsp;</span><span class="c4">Implicits</span
          ><span class="c3">&nbsp;</span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">AvroByteStreams</span
          ><span class="c3"
            >{<br />
            &nbsp; </span
          ><span class="c0">implicit</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span
          ><span class="c3">&nbsp;createTestRW = </span
          ><span class="c4">Typebus</span><span class="c3">.declareType[</span
          ><span class="c4">CreateTestCommand</span><span class="c3">, </span
          ><span class="c4">AvroByteStreamReader</span><span class="c3">[</span
          ><span class="c4">CreateTestCommand</span><span class="c3">], </span
          ><span class="c4">AvroByteStreamWriter</span><span class="c3">[</span
          ><span class="c4">CreateTestCommand</span
          ><span class="c3"
            >]]<br />
            &nbsp; </span
          ><span class="c0">implicit</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span><span class="c3">&nbsp;</span
          ><span class="c4">TestRW</span><span class="c3">&nbsp;= </span
          ><span class="c4">Typebus</span><span class="c3">.declareType[</span
          ><span class="c4">Test</span><span class="c3">, </span
          ><span class="c4">AvroByteStreamReader</span><span class="c3">[</span
          ><span class="c4">Test</span><span class="c3">], </span
          ><span class="c4">AvroByteStreamWriter</span><span class="c3">[</span
          ><span class="c4">Test</span
          ><span class="c3"
            >]]<br />
            &nbsp; </span
          ><span class="c0">implicit</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span><span class="c3">&nbsp;getTestRW = </span
          ><span class="c4">Typebus</span><span class="c3">.declareType[</span
          ><span class="c4">GetTestCommand</span><span class="c3">, </span
          ><span class="c4">AvroByteStreamReader</span><span class="c3">[</span
          ><span class="c4">GetTestCommand</span><span class="c3">], </span
          ><span class="c4">AvroByteStreamWriter</span><span class="c3">[</span
          ><span class="c4">GetTestCommand</span
          ><span class="c3"
            >]]<br />
            }<br /><br /> </span
          ><span class="c0">trait</span><span class="c3">&nbsp;</span
          ><span class="c4">TestDatabase</span
          ><span class="c3"
            >{<br />
            &nbsp; </span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">createTest</span><span class="c3">(x: </span
          ><span class="c4">CreateTestCommand</span><span class="c3">): </span
          ><span class="c4">Future</span><span class="c3">[</span
          ><span class="c4">Test</span
          ><span class="c3"
            >]<br />
            &nbsp; </span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">getTest</span><span class="c3">(x: </span
          ><span class="c4">GetTestCommand</span><span class="c3">): </span
          ><span class="c4">Future</span><span class="c3">[</span
          ><span class="c4">Test</span
          ><span class="c3"
            >]<br />
            }<br />}<br /><br /><br
          /></span>
        </p>
      </td>
    </tr>
  </tbody>
</table>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.cf2g984qe63e"><span class="c6">Service</span></h2>
<p class="c7">
  <span class="c1"
    >Services are classes that define methods that transform data types for the
    kafka bus. &nbsp;Each API call gets a decorator @SeiviceMethod as well as
    being registered with optional kafka partition keys and retry
    policies.</span
  >
</p>
<p class="c7 c13"><span class="c1"></span></p>
<a id="t.a39283d8813bfcb8c24bc9ef264727e158712f93"></a><a id="t.1"></a>
<table class="c32">
  <tbody>
    <tr class="c24">
      <td class="c25" colspan="1" rowspan="1">
        <p class="c9">
          <span class="c0">class</span><span class="c3">&nbsp;</span
          ><span class="c4">TestserviceService</span
          ><span class="c3">(serviceIdentifier: </span
          ><span class="c4">ServiceIdentifier</span
          ><span class="c3">, publisher: </span><span class="c4">Publisher</span
          ><span class="c3">, sys: </span><span class="c4">ActorSystem</span
          ><span class="c3">, testDb: </span><span class="c4">TestDatabase</span
          ><span class="c3">) </span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">Service</span
          ><span class="c3">(serviceIdentifier,publisher) </span
          ><span class="c0">with</span><span class="c3">&nbsp;</span
          ><span class="c4">AvroByteStreams</span
          ><span class="c3">{<br /> </span><span class="c0">implicit</span
          ><span class="c3">&nbsp;</span><span class="c0">val</span
          ><span class="c3"
            >&nbsp;system = sys<br /><br />
            system.log.info(</span
          ><span class="c31">&quot;Starting service: &quot;</span
          ><span class="c3">&nbsp;+ serviceIdentifier.name)<br /> </span
          ><span class="c0">val</span
          ><span class="c3">&nbsp;bus = publisher.busActor<br /> </span
          ><span class="c0">import</span
          ><span class="c3">&nbsp;com.affine.</span
          ><span class="c4">TestService</span><span class="c3">.data.</span
          ><span class="c4">Implicits</span
          ><span class="c3">._<br /><br /> </span
          ><span class="c42">@ServiceMethod</span><span class="c3"><br /> </span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">createTest</span
          ><span class="c3">(createTest: </span
          ><span class="c4">CreateTestCommand</span
          ><span class="c3">, meta: </span><span class="c4">EventMeta</span
          ><span class="c3">): </span><span class="c4">Future</span
          ><span class="c3">[</span><span class="c4">Test</span
          ><span class="c3"
            >] = testDb.createTest(createTest)<br />
            registerStream(createTest _)<br />
            &nbsp; .withPartitionKey(_.id.toString)<br /><br /> </span
          ><span class="c42">@ServiceMethod</span><span class="c3"><br /> </span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">getTest</span><span class="c3">(getTest: </span
          ><span class="c4">GetTestCommand</span><span class="c3">, meta: </span
          ><span class="c4">EventMeta</span><span class="c3">): </span
          ><span class="c4">Future</span><span class="c3">[</span
          ><span class="c4">Test</span
          ><span class="c3"
            >] = testDb.getTest(getTest)<br />
            registerStream(getTest _)<br />
            &nbsp; .withRetryPolicy{<br />
            &nbsp; </span
          ><span class="c0">case</span
          ><span class="c3">&nbsp;_ =&gt; typebus.bus.</span
          ><span class="c4">RetryPolicy</span><span class="c3">(</span
          ><span class="c37">3</span><span class="c3">, </span
          ><span class="c37">1</span><span class="c3">&nbsp;second, </span
          ><span class="c4">RetryBackoff</span><span class="c3">.</span
          ><span class="c4">Exponential</span
          ><span class="c3"
            >)<br />
            }<br /><br />
            system.log.info(</span
          ><span class="c31"
            >&quot;Finished registering streams, trying to start
            service.&quot;</span
          ><span class="c3">)<br /><br />}</span>
        </p>
      </td>
    </tr>
  </tbody>
</table>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.bk5g3zu288w5">
  <span class="c6">Service Loader</span>
</h2>
<p class="c7">
  <span class="c1"
    >Working on a simple auto wire DI injection loader. &nbsp;So far this code
    is pretty simple:</span
  >
</p>
<a id="t.50933ddb3708d87f5b201ae0684606ee4a1f46dd"></a><a id="t.2"></a>
<table class="c32">
  <tbody>
    <tr class="c24">
      <td class="c25" colspan="1" rowspan="1">
        <p class="c9">
          <span class="c0">val</span><span class="c3">&nbsp;TestEntity = </span
          ><span class="c0">new</span
          ><span class="c3"
            >&nbsp;TestEntity<br />persistentEntityRegistry.register(wire[TestEntity])<br /><br /></span
          ><span class="c0">lazy</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span
          ><span class="c3">&nbsp;serviceIdentity = ServiceIdentifier(</span
          ><span class="c31">&quot;testservice&quot;</span
          ><span class="c3">)<br /></span><span class="c0">lazy</span
          ><span class="c3">&nbsp;</span><span class="c0">val</span
          ><span class="c3">&nbsp;producer = </span><span class="c0">new</span
          ><span class="c3"
            >&nbsp;TypebusKafkaProducer(serviceIdentity, system)<br /></span
          ><span class="c0">lazy</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span><span class="c3">&nbsp;service = </span
          ><span class="c0">new</span
          ><span class="c3"
            >&nbsp;TestserviceService(serviceIdentity, producer, system, </span
          ><span class="c0">new</span
          ><span class="c3"
            >&nbsp;TestEntityDatabase(persistentEntityRegistry) )<br /></span
          ><span class="c0">lazy</span><span class="c3">&nbsp;</span
          ><span class="c0">val</span><span class="c3">&nbsp;consumer = </span
          ><span class="c0">new</span
          ><span class="c3"
            >&nbsp;TypebusKafkaConsumer(service, producer, system)<br /><br />TypebusApplication<br />(<br />
            system,<br />
            serviceIdentity,<br />
            producer,<br />
            service,<br />
            consumer<br />)</span
          >
        </p>
      </td>
    </tr>
  </tbody>
</table>
<p class="c7 c13"><span class="c1"></span></p>
<h2 class="c26" id="h.u33zu9amzvpp"><span class="c6">Entity</span></h2>
<p class="c7 c13"><span class="c1"></span></p>
<a id="t.9376a13cc249307651b6eb014c0c78f6cf02c72e"></a><a id="t.3"></a>
<table class="c32">
  <tbody>
    <tr class="c24">
      <td class="c25" colspan="1" rowspan="1">
        <p class="c9">
          <span class="c0">class</span><span class="c3">&nbsp;</span
          ><span class="c4">TestEntity</span><span class="c3">&nbsp;</span
          ><span class="c0">extends</span><span class="c3">&nbsp;</span
          ><span class="c4">PersistentEntity</span
          ><span class="c3">&nbsp;{<br /><br /> </span
          ><span class="c0">override</span><span class="c3">&nbsp;</span
          ><span class="c0">type</span><span class="c3">&nbsp;</span
          ><span class="c4">Command</span><span class="c3">&nbsp;= </span
          ><span class="c4">TestCommand</span><span class="c3">[_]<br /> </span
          ><span class="c0">override</span><span class="c3">&nbsp;</span
          ><span class="c0">type</span><span class="c3">&nbsp;</span
          ><span class="c4">Event</span><span class="c3">&nbsp;= </span
          ><span class="c4">TestEvent</span><span class="c3"><br /> </span
          ><span class="c0">override</span><span class="c3">&nbsp;</span
          ><span class="c0">type</span><span class="c3">&nbsp;</span
          ><span class="c4">State</span><span class="c3">&nbsp;= </span
          ><span class="c4">TestState</span><span class="c3"><br /><br /> </span
          ><span class="c0">override</span><span class="c3">&nbsp;</span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">initialState</span><span class="c3">&nbsp;= </span
          ><span class="c4">TestState</span><span class="c3">(</span
          ><span class="c4">None</span><span class="c3">, </span
          ><span class="c4">LocalDateTime</span
          ><span class="c3">.now().toString)<br /><br /> </span
          ><span class="c0">override</span><span class="c3">&nbsp;</span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">behavior</span><span class="c3">: (</span
          ><span class="c4">TestState</span><span class="c3">) =&gt; </span
          ><span class="c4">Actions</span
          ><span class="c3"
            >&nbsp;= {<br />
            &nbsp; </span
          ><span class="c0">case</span><span class="c3">&nbsp;</span
          ><span class="c4">TestState</span><span class="c3">(_, _) =&gt; </span
          ><span class="c4">Actions</span
          ><span class="c3"
            >()<br />
            &nbsp; &nbsp; .onCommand[</span
          ><span class="c4">CreateTestCommand</span><span class="c3">, </span
          ><span class="c4">Test</span
          ><span class="c3"
            >] {<br />
            &nbsp; &nbsp; </span
          ><span class="c0">case</span><span class="c3">&nbsp;(</span
          ><span class="c4">CreateTestCommand</span
          ><span class="c3"
            >(x), ctx, _) &rArr;<br />
            &nbsp; &nbsp; &nbsp; ctx.thenPersist(</span
          ><span class="c4">TestCreated</span
          ><span class="c3"
            >(x))(_ &rArr; ctx.reply(x))<br />
            &nbsp; }.onReadOnlyCommand[</span
          ><span class="c4">GetTestCommand</span><span class="c3">, </span
          ><span class="c4">Test</span
          ><span class="c3"
            >] {<br />
            &nbsp; &nbsp; </span
          ><span class="c0">case</span><span class="c3">&nbsp;(</span
          ><span class="c4">GetTestCommand</span
          ><span class="c3"
            >(id), ctx, state) =&gt;<br />
            &nbsp; &nbsp; &nbsp; ctx.reply(state.entity.getOrElse(</span
          ><span class="c4">Test</span><span class="c3">(id, </span
          ><span class="c31">&quot;not found&quot;</span
          ><span class="c3"
            >)))<br />
            &nbsp; }<br />
            &nbsp; &nbsp; .onEvent {<br />
            &nbsp; &nbsp; &nbsp; </span
          ><span class="c0">case</span><span class="c3">&nbsp;(</span
          ><span class="c4">TestCreated</span
          ><span class="c3"
            >(x), _) &rArr;<br />
            &nbsp; &nbsp; &nbsp; &nbsp; </span
          ><span class="c4">TestState</span><span class="c3">(</span
          ><span class="c4">Some</span><span class="c3">(x), </span
          ><span class="c4">LocalDateTime</span
          ><span class="c3"
            >.now().toString)<br />
            &nbsp; &nbsp; }<br />
            }<br />}<br /><br /></span
          ><span class="c0">class</span><span class="c3">&nbsp;</span
          ><span class="c4">TestEntityDatabase</span
          ><span class="c3">(persistentEntityRegistry: </span
          ><span class="c4">PersistentEntityRegistry</span
          ><span class="c3">) </span><span class="c0">extends</span
          ><span class="c3">&nbsp;</span><span class="c4">TestDatabase</span
          ><span class="c3">{<br /> </span><span class="c0">def</span
          ><span class="c3">&nbsp;</span><span class="c4">createTest</span
          ><span class="c3">(x: </span><span class="c4">CreateTestCommand</span
          ><span class="c3">): </span><span class="c4">Future</span
          ><span class="c3">[</span><span class="c4">Test</span
          ><span class="c3">] = persistentEntityRegistry.refFor[</span
          ><span class="c4">TestEntity</span
          ><span class="c3">](x.entity.id.toString).ask(x)<br /> </span
          ><span class="c0">def</span><span class="c3">&nbsp;</span
          ><span class="c4">getTest</span><span class="c3">(x: </span
          ><span class="c4">GetTestCommand</span><span class="c3">): </span
          ><span class="c4">Future</span><span class="c3">[</span
          ><span class="c4">Test</span
          ><span class="c3">] = persistentEntityRegistry.refFor[</span
          ><span class="c4">TestEntity</span
          ><span class="c3">](x.id.toString).ask(x)<br />}</span>
        </p>
      </td>
    </tr>
  </tbody>
</table>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c13"><span class="c1"></span></p>
<p class="c7 c12"><span class="c1"></span></p>
<p class="c7 c12"><span class="c1"></span></p>
<div>
  <p class="c27 c13"><span class="c1"></span></p>
</div>
</article>